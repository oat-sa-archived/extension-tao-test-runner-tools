define("taoTestRunnerTools/controller/routes",{TestRunner:{css:"testrunner",actions:{index:"controller/TestRunner/index",timer:"controller/TestRunner/timer"}}}),define("taoTestRunnerTools/controller/TestRunner/index",["jquery","lodash","i18n","layout/loading-bar","ui/button"],function($,_,__,loadingBar,buttonFactory){"use strict";return{start:function(){function reload(){loadingBar.start(),window.location.reload()}var $container=$(".container"),$toolbar=$(".toolbar",$container),buttons=($(".content",$container),{});buttons.reload=buttonFactory({id:"reload",label:__("Reload"),type:"info",icon:"reload",renderTo:$toolbar}).on("click",reload)}}}),define("tpl!taoTestRunnerTools/templates/TestRunner/durations",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n    <div class="duration">\n        <span class="label">',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>\n        <span class="value">',(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n    </div>\n    ";
}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="durations">\n    ',stack1=helpers.each.call(depth0,depth0,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>\n"})}),define("taoTestRunnerTools/controller/TestRunner/timer",["jquery","lodash","i18n","moment","util/url","core/promise","core/logger","core/store","core/dataProvider/request","core/polling","core/encoder/time","layout/loading-bar","tpl!taoTestRunnerTools/templates/TestRunner/durations","ui/button","ui/datatable"],function($,_,__,moment,urlHelper,Promise,loggerFactory,storeFactory,request,pollingFactory,timeEncoder,loadingBar,durationTpl,buttonFactory){
"use strict";function formatDurations(durations){var dataDurations=[];return _.forEach(durations,function(value,key){dataDurations.push({label:key,value:value&&timeEncoder.encode(value+"s")||"-"})}),dataDurations.sort(function(a,b){return a.label.localeCompare(b.label)}),durationTpl(dataDurations)}return{start:function(){function update(){return request(dataUrl).then(function(data){var itemAttemptId,isDiff,isNew=!last||lastId!==data.id||last.state!==data.state,promises=[],localDurations={},localTimers={};return data.timestamp=Date.now(),data.timestampLabel=moment(data.timestamp).format("LLL"),data.remainingLabel=_.isEmpty(data.remaining)?"-":timeEncoder.encode(data.remaining),
data.serverDuration=data.durations&&formatDurations(data.durations.server),data.clientDuration=data.durations&&formatDurations(data.durations.client),data.extraDuration=data.extraTime&&formatDurations(data.extraTime),data.running||stopPolling(),data.identifiers&&(itemAttemptId=data.identifiers.item+"#"+data.identifiers.attempt,promises.push(durationStore.getItem(itemAttemptId).then(function(duration){localDurations.duration=_.isNumber(duration)?duration:0}))),data.timers&&_.forEach(data.timers,function(timer){promises.push(timerStore.getItem(timer.id).then(function(remaining){localTimers[timer.label]=_.isNumber(remaining)?remaining/1e3:0}))}),Promise.all(promises).then(function(){
data.localDuration=formatDurations(localDurations),data.localTimers=formatDurations(localTimers),!last||isNew?data.startTimers=data.localTimers:last.startTimers&&(data.startTimers=last.startTimers),isDiff=!_.isEqual(last,data),last=data,lastId=data.id,isNew?history.unshift(data):isDiff&&(history.shift(),history.unshift(data)),(isNew||isDiff)&&$content.datatable("refresh",{data:history})})})["catch"](function(err){logger.error(err)})}function reload(){stopPolling(),loadingBar.start(),window.location.reload()}function index(){stopPolling(),loadingBar.start(),window.location.href=urlHelper.route("index","TestRunner","taoTestRunnerTools")}function startPolling(){
polling.start(),buttons.stop.show(),buttons.start.hide(),buttons.ping.hide()}function stopPolling(){polling.stop(),buttons.stop.hide(),buttons.start.show(),buttons.ping.show()}var last,lastId,timerStore,durationStore,$container=$(".container"),$toolbar=$(".toolbar",$container),$content=$(".content",$container),currentRoute=urlHelper.parse(window.location.href),sessionId=currentRoute.query.deliveryExecution&&decodeURIComponent(currentRoute.query.deliveryExecution),dataUrl=urlHelper.route("deliveryExecutionData","TestRunner","taoTestRunnerTools",{deliveryExecution:sessionId}),history=[],buttons={},logger=loggerFactory("taoTestRunnerTools/TestRunner/timer"),polling=pollingFactory({
interval:1e3,action:function(p){var promise=p.async();update().then(function(){promise.resolve()})}});buttons.back=buttonFactory({id:"back",label:__("Index"),type:"info",icon:"left",renderTo:$toolbar}).on("click",index),buttons.reload=buttonFactory({id:"reload",label:__("Reload"),type:"info",icon:"reload",renderTo:$toolbar}).on("click",reload),buttons.start=buttonFactory({id:"start",label:__("Start watching"),type:"info",icon:"play",renderTo:$toolbar}).on("click",startPolling).hide(),buttons.stop=buttonFactory({id:"stop",label:__("Stop watching"),type:"info",icon:"stop",renderTo:$toolbar}).on("click",stopPolling).hide(),buttons.ping=buttonFactory({id:"ping",label:__("Ping"),
type:"info",icon:"target",renderTo:$toolbar}).on("click",function(){buttons.ping.disable(),update().then(function(){buttons.ping.enable()})}).hide(),$content.datatable({paginationStrategyTop:"none",paginationStrategyBottom:"none",model:[{id:"timestampLabel",label:__("Timestamp")},{id:"state",label:__("State")},{id:"position",label:__("Position")},{id:"remainingLabel",label:__("Server Timer")},{id:"serverDuration",label:__("Server durations")},{id:"clientDuration",label:__("Client durations")},{id:"extraDuration",label:__("Extra time")},{id:"localDuration",label:__("Browser durations")},{id:"localTimers",label:__("Client Timers")},{id:"startTimers",label:__("From timers")
}]}),Promise.all([storeFactory("timer-"+sessionId).then(function(store){timerStore=store}),storeFactory("duration-"+sessionId).then(function(store){durationStore=store})]).then(function(){startPolling()})["catch"](function(err){logger.error(err)})}}});
//# sourceMappingURL=controllers.min.js.map